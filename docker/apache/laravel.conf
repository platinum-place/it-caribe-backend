<VirtualHost *:8080>
    ServerName localhost
    DocumentRoot "/app/public"
    DirectoryIndex index.php

    <Directory "/app/public">
        Options FollowSymLinks
        AllowOverride All
        Require all granted

        RewriteEngine On

        RewriteCond %{HTTP:Authorization} .
        RewriteRule .* - [E=HTTP_AUTHORIZATION:%{HTTP:Authorization}]

        # Redirigir todo a index.php si el archivo/directorio no existe
        RewriteCond %{REQUEST_FILENAME} !-d
        RewriteCond %{REQUEST_FILENAME} !-f
        RewriteRule ^ index.php [L]
    </Directory>

    <FilesMatch "\.php$">
        SetHandler "proxy:fcgi://php-fpm:9000"
    </FilesMatch>

    # Logs
    ErrorLog /opt/bitnami/apache/logs/error.log
    CustomLog /opt/bitnami/apache/logs/access.log combined
    LogLevel warn
</VirtualHost>

<VirtualHost *:8443>
    ServerName localhost
    DocumentRoot "/app/public"
    DirectoryIndex index.php

    SSLEngine on
    SSLCertificateFile "/opt/bitnami/apache/conf/bitnami/certs/server.crt"
    SSLCertificateKeyFile "/opt/bitnami/apache/conf/bitnami/certs/server.key"

    <Directory "/app/public">
        Options FollowSymLinks
        AllowOverride All
        Require all granted

        RewriteEngine On
        RewriteCond %{HTTP:Authorization} .
        RewriteRule .* - [E=HTTP_AUTHORIZATION:%{HTTP:Authorization}]
        RewriteCond %{REQUEST_FILENAME} !-d
        RewriteCond %{REQUEST_FILENAME} !-f
        RewriteRule ^ index.php [L]
    </Directory>

    <FilesMatch "\.php$">
        SetHandler "proxy:fcgi://php-fpm:9000"
    </FilesMatch>

    ErrorLog /opt/bitnami/apache/logs/ssl_error.log
    CustomLog /opt/bitnami/apache/logs/ssl_access.log combined
</VirtualHost>
